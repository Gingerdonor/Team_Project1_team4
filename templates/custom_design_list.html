{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    <div class="main-header">
        <h2>{{ title }}</h2>
    </div>
    <hr class="main-divider">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
            <br>
        {% endif %}
    {% endwith %}

    <div class="design-gallery">
        {% for design in all_designs %}
            
            {% set is_owned = design.id in owned_design_ids %}
            {% set is_active = design.id == active_design_id %}

            <div class="design-card {{ 'owned' if is_owned else 'locked' }} {{ 'active' if is_active else '' }}">
                <div class="thumbnail-placeholder">
                    [ì¸ë„¤ì¼]
                </div>
                <h3>{{ design.name }}</h3>
                <p>{{ design.description }}</p>

                <div class="card-footer">
                    {% if is_owned %}
                        {% if is_active %}
                            <button class="design-button active" disabled>âœ”ï¸ ì ìš©ë¨</button>
                        {% else %}
                            <button class="design-button apply-btn" data-design-id="{{ design.id }}">ì ìš©í•˜ê¸°</button>
                        {% endif %}
                    {% else %}
                        <span class="lock-icon">ğŸ”’ ì ê¹€</span>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

<style>
    .design-gallery {
        display: grid;
        /* 1fr = 1 fractional unit, 1ê°œì˜ ê· ë“±í•œ ë¹„ìœ¨ */
        /* 250pxë³´ë‹¤ ì‘ì•„ì§ˆ ìˆ˜ ì—†ìŒ, ìµœëŒ€ 1fr(ê· ë“±) */
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }
    .design-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        background: #fff;
        display: flex;
        flex-direction: column;
    }
    .thumbnail-placeholder {
        height: 150px;
        background: #f4f4f4;
        border-radius: 12px 12px 0 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;
        font-weight: bold;
    }
    .design-card h3 {
        font-size: 1.2em;
        margin: 15px;
        color: #333;
    }
    .design-card p {
        font-size: 0.9em;
        color: #666;
        margin: 0 15px 15px;
        flex-grow: 1; /* p íƒœê·¸ê°€ ë‚¨ì€ ê³µê°„ì„ ì±„ì›€ */
    }
    .card-footer {
        padding: 15px;
        border-top: 1px solid #f0f0f0;
        background: #fcfcfc;
        border-radius: 0 0 12px 12px;
    }
    
    /* ë””ìì¸ ë²„íŠ¼ (ì ìš©í•˜ê¸°) */
    .design-button {
        width: 100%;
        padding: 10px;
        font-size: 1em;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    .design-button.apply-btn {
        background-color: #007bff;
        color: white;
    }
    .design-button.active {
        background-color: #28a745;
        color: white;
    }
    
    /* ì ê¸´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .design-card.locked {
        background: #f9f9f9;
        opacity: 0.7;
    }
    .design-card.locked .thumbnail-placeholder {
        background: #eee;
    }
    .lock-icon {
        font-size: 1em;
        font-weight: bold;
        color: #888;
        text-align: center;
        display: block;
    }

    /* í™œì„±í™”ëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .design-card.active {
        border: 2px solid #28a745; /* ë…¹ìƒ‰ í…Œë‘ë¦¬ */
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
</style>

<script>
    // 'ì ìš©í•˜ê¸°' ë²„íŠ¼ë“¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.apply-btn').forEach(button => {
        button.addEventListener('click', function() {
            const designId = this.dataset.designId;
            
            // 1. APIì— POST ìš”ì²­
            fetch('{{ url_for("set_active_design") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ design_id: designId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 2. ì„±ê³µ ì‹œ, í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    // (ë˜ëŠ” JSë¡œ 'ì ìš©ë¨' ìƒíƒœë¡œ ì¦‰ì‹œ ë³€ê²½í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤)
                    alert(data.message); // "ì ìš©í–ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
                    window.location.reload(); 
                } else {
                    // 3. ì‹¤íŒ¨ ì‹œ, ì—ëŸ¬ ë©”ì‹œì§€
                    alert('ì˜¤ë¥˜: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        });
    });
</script>
{% endblock %}